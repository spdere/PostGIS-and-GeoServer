PostGIS installation

Postgresql:
sudo apt-get install postgresql-9.3 postgresql-contrib-9.3 pgadmin3

Postgis:
sudo apt-get install postgis postgresql-9.3-postgis-2.1 postgresql-9.3-postgis-2.1-scripts

GeoServer installation:
sudo apt-get install apache2 tomcat7 tomcat7-admin

Install GeoServer war:
wget http://sourceforge.net/projects/geoserver/files/GeoServer/2.4.0/geoserver-2.4.0-war.zip
unzip geoserver-2.4.0-war.zip geoserver.war
sudo mv geoserver.war /var/lib/tomcat7/webapps/

(It can take a little while for the web app to load, check if it is running
by redirecting your browser to: http://localhost:8080/geoserver login with username admin and password geoserver)

Configure reverse proxy (Apache2):
sudo a2enmod proxy proxy_ajp
sudo vi /etc/apache2/sites-enabled/000-default.conf

Add the following line (note the port):
        ServerAdmin webmaster@localhost
        ServerAlias localhost
        ServerName localhost
        ProxyPass /geoserver ajp://localhost:8009/geoserver
        ProxyPassReverse /geoserver ajp://localhost:8009/geoserver
        
then, the file 000-default.conf looks like this:
<VirtualHost *:80>
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/html
        ServerAlias localhost
        ServerName localhost

        ProxyPass /geoserver ajp://localhost:8009/geoserver
        ProxyPassReverse /geoserver ajp://localhost:8009/geoserver

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

Restart apache:
sudo service apache2 restart
(If you now go to http://localhost/geoserver you will get a 503 error instead of a 404 since we first have to configure Tomcat7.)

Configure AJP Connector (Tomcat7)
Open up the server.xml file:
sudo vi /etc/tomcat7/server.xml

Look for this fragment:
<!-- Define an AJP 1.3 Connector on port 8009 -->
<!--
<Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />
-->
Change to:
<!-- Define an AJP 1.3 Connector on port 8009 -->
<Connector port="8009" protocol="AJP/1.3" />
Save the file and restart Tomcat:
sudo service tomcat7 restart

If you now browse to http://localhost/geoserver you should see geoserver through apache2 reverse proxy. (first time could take a while since the app is restarting) If you still get a 503 error (temporary unavailable) first try a refresh, if that doesn't help, try and restart Apache2.
